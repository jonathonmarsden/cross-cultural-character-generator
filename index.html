<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cross-Cultural Character Generator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f8fafc;
            color: #0f172a;
            line-height: 1.6;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .main-layout {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 30px;
        }

        @media (max-width: 1024px) {
            .main-layout {
                grid-template-columns: 1fr;
            }
        }

        header {
            background: white;
            color: #0f172a;
            padding: 48px 0;
            margin-bottom: 32px;
            border-bottom: 1px solid #e2e8f0;
        }

        h1 {
            text-align: center;
            font-size: 2.5em;
            font-weight: 600;
            color: #0f172a;
            letter-spacing: -0.02em;
            margin-bottom: 12px;
        }

        .header-subtitle {
            text-align: center;
            color: #64748b;
            font-size: 1.1em;
            font-weight: 400;
            max-width: 600px;
            margin: 0 auto;
        }

        .panel {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
        }

        .panel h2 {
            color: #0f172a;
            font-size: 1.5em;
            font-weight: 600;
            letter-spacing: -0.01em;
            margin-bottom: 32px;
        }

        .name-input-section {
            margin-bottom: 25px;
        }

        .name-input-section input[type="text"] {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.2s ease;
            background: white;
        }

        .name-input-section input[type="text"]:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .saved-characters-panel {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05), 0 1px 2px rgba(0,0,0,0.1);
            border: 1px solid #e2e8f0;
            height: fit-content;
            max-height: calc(100vh - 140px);
            overflow-y: auto;
        }

        .search-box {
            margin-bottom: 24px;
        }

        .search-box input {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 0.95em;
            transition: all 0.2s ease;
            background: white;
        }

        .search-box input:focus {
            outline: none;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .character-card {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 16px;
            border: 1px solid #e2e8f0;
            transition: all 0.2s ease;
        }

        .character-card:hover {
            border-color: #6366f1;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.15);
        }

        .character-card h4 {
            margin: 0 0 12px 0;
            color: #0f172a;
            font-size: 1.05em;
            font-weight: 600;
        }

        .character-card .character-meta {
            font-size: 0.875em;
            color: #64748b;
            margin-bottom: 6px;
            line-height: 1.5;
        }

        .character-card .character-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .character-card .btn-small {
            padding: 8px 16px;
            font-size: 0.875em;
            font-weight: 500;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .character-card .btn-load {
            background: #6366f1;
            color: white;
            flex: 1;
        }

        .character-card .btn-load:hover {
            background: #4f46e5;
        }

        .character-card .btn-delete {
            background: #ef4444;
            color: white;
        }

        .character-card .btn-delete:hover {
            background: #dc2626;
        }

        .export-import-section {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e2e8f0;
        }

        .export-import-section h4 {
            color: #0f172a;
            font-weight: 600;
            font-size: 0.95em;
        }

        .export-import-section .btn-small {
            width: 100%;
            margin-bottom: 12px;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95em;
            font-weight: 500;
            transition: all 0.2s ease;
        }

        .btn-export {
            background: #6366f1;
            color: white;
        }

        .btn-export:hover {
            background: #4f46e5;
        }

        .btn-import {
            background: #64748b;
            color: white;
        }

        .btn-import:hover {
            background: #475569;
        }

        .empty-state {
            text-align: center;
            padding: 64px 32px;
            color: #94a3b8;
        }

        .empty-state p {
            margin-top: 12px;
            font-size: 0.95em;
            line-height: 1.6;
        }

        .section {
            margin-bottom: 25px;
        }

        .section h3 {
            margin-bottom: 16px;
            color: #0f172a;
            font-size: 1em;
            font-weight: 600;
        }

        .option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
        }

        .option-item {
            position: relative;
        }

        .option-item input[type="radio"],
        .option-item input[type="checkbox"] {
            position: absolute;
            opacity: 0;
        }

        .option-item label {
            display: block;
            padding: 10px 14px;
            background: white;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            font-size: 0.875em;
            font-weight: 500;
        }

        .option-item input:checked + label {
            background: #6366f1;
            color: white;
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .option-item label:hover {
            border-color: #6366f1;
        }

        .prompt-output {
            background: #0f172a;
            color: #e2e8f0;
            padding: 24px;
            border-radius: 10px;
            font-family: 'Courier New', monospace;
            font-size: 0.875em;
            line-height: 1.7;
            margin-bottom: 24px;
            cursor: pointer;
            position: relative;
            min-height: 120px;
            word-wrap: break-word;
            border: 1px solid #1e293b;
        }

        .prompt-output:hover::after {
            content: 'Click to copy';
            position: absolute;
            top: 12px;
            right: 12px;
            background: #334155;
            color: #e2e8f0;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 0.75em;
            font-family: 'Inter', sans-serif;
        }

        .filename-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 24px;
            border: 1px solid #e2e8f0;
        }

        .filename-section h4 {
            margin-bottom: 12px;
            color: #0f172a;
            font-size: 0.95em;
            font-weight: 600;
        }

        .filename-output {
            background: white;
            border: 1px solid #cbd5e1;
            padding: 12px 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.875em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            word-break: break-all;
            overflow-wrap: break-word;
            transition: all 0.2s ease;
        }

        .filename-output:hover {
            border-color: #6366f1;
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .copy-icon {
            color: #6366f1;
            flex-shrink: 0;
            font-size: 1.2em;
        }

        #filename-text {
            flex: 1;
            min-width: 0;
            color: #0f172a;
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            background: #6366f1;
            color: white;
            width: 100%;
        }

        .btn:hover {
            background: #4f46e5;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.25);
        }

        .btn:disabled {
            background: #cbd5e1;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #f8fafc;
            color: #64748b;
            border: 1px solid #cbd5e1;
            margin-top: 12px;
        }

        .btn-secondary:hover {
            background: #f1f5f9;
            color: #475569;
            box-shadow: none;
        }

        .toast {
            position: fixed;
            bottom: 32px;
            right: 32px;
            background: #0f172a;
            color: white;
            padding: 16px 24px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 1000;
            font-weight: 500;
            border: 1px solid #1e293b;
        }

        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }

        .toast.error {
            background: #ef4444;
            border-color: #dc2626;
        }

        .info-box {
            background: #eff6ff;
            border: 1px solid #bfdbfe;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 24px;
            font-size: 0.9em;
        }

        .info-box h4 {
            color: #1e40af;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .info-box ul {
            margin-left: 20px;
            color: #475569;
        }

        .info-box li {
            margin-bottom: 6px;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <h1>Cross-Cultural Character Generator</h1>
            <p class="header-subtitle">Create diverse, culturally-aware character illustrations for training materials</p>
        </div>
    </header>

    <div class="container">
        <div class="main-layout">
            <div class="panel">
                <h2 style="margin-bottom: 25px;">Generate Character</h2>

                <div class="name-input-section">
                    <h3>Character Name</h3>
                    <input type="text" id="character-name" placeholder="Enter character name (e.g., Maria Rodriguez, John Smith)">
                </div>

                <div class="section">
                <h3>Age Group</h3>
                <div class="option-grid">
                    <div class="option-item">
                        <input type="radio" name="age" id="age-child" value="child">
                        <label for="age-child">Child (8-12)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="age" id="age-teen" value="teen">
                        <label for="age-teen">Teen (13-19)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="age" id="age-young-adult" value="young-adult" checked>
                        <label for="age-young-adult">Young Adult (20-35)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="age" id="age-middle" value="middle-age">
                        <label for="age-middle">Middle Age (36-55)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="age" id="age-senior" value="senior">
                        <label for="age-senior">Senior (56+)</label>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Gender Presentation</h3>
                <div class="option-grid">
                    <div class="option-item">
                        <input type="radio" name="gender" id="gender-masculine" value="masculine">
                        <label for="gender-masculine">Masculine</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="gender" id="gender-feminine" value="feminine" checked>
                        <label for="gender-feminine">Feminine</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="gender" id="gender-nonbinary" value="non-binary">
                        <label for="gender-nonbinary">Non-binary</label>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Ethnicity/Region</h3>
                <div class="option-grid">
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-east-asian" value="east-asian">
                        <label for="eth-east-asian">East Asian</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-south-asian" value="south-asian" checked>
                        <label for="eth-south-asian">South Asian</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-middle-eastern" value="middle-eastern">
                        <label for="eth-middle-eastern">Middle Eastern</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-african" value="african">
                        <label for="eth-african">African</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-latin" value="latin-american">
                        <label for="eth-latin">Latin American</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-north-euro" value="northern-european">
                        <label for="eth-north-euro">Northern European</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-south-euro" value="southern-european">
                        <label for="eth-south-euro">Southern European</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-pacific" value="pacific-islander">
                        <label for="eth-pacific">Pacific Islander</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-indigenous" value="indigenous">
                        <label for="eth-indigenous">Indigenous</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="ethnicity" id="eth-mixed" value="mixed">
                        <label for="eth-mixed">Mixed Heritage</label>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Profession/Role</h3>
                <div class="option-grid">
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-business" value="business" checked>
                        <label for="prof-business">Business Professional</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-healthcare" value="healthcare">
                        <label for="prof-healthcare">Healthcare Worker</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-teacher" value="teacher">
                        <label for="prof-teacher">Teacher/Educator</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-tech" value="tech">
                        <label for="prof-tech">Tech Worker</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-service" value="service">
                        <label for="prof-service">Service Worker</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-student" value="student">
                        <label for="prof-student">Student</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-trades" value="trades">
                        <label for="prof-trades">Skilled Trades</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-creative" value="creative">
                        <label for="prof-creative">Creative Professional</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-scientist" value="scientist">
                        <label for="prof-scientist">Scientist/Researcher</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="profession" id="prof-farmer" value="farmer">
                        <label for="prof-farmer">Agricultural Worker</label>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Additional Diversity (Optional)</h3>
                <p style="font-size: 0.8em; color: #e74c3c; margin: -10px 0 10px 0; font-style: italic; display: none;" id="diversity-note">
                    Note: Some items may be automatically excluded if they conflict with professional attire (e.g., turban with hard hat)
                </p>
                <div class="option-grid">
                    <div class="option-item">
                        <input type="checkbox" id="div-wheelchair" value="wheelchair">
                        <label for="div-wheelchair">Wheelchair User</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="div-prosthetic" value="prosthetic">
                        <label for="div-prosthetic">Prosthetic Limb</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="div-glasses" value="glasses">
                        <label for="div-glasses">Glasses</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="div-cane" value="cane">
                        <label for="div-cane">Walking Cane</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="div-hijab" value="hijab">
                        <label for="div-hijab">Hijab</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="div-turban" value="turban">
                        <label for="div-turban">Turban</label>
                    </div>
                    <div class="option-item">
                        <input type="checkbox" id="div-plus-size" value="plus-size">
                        <label for="div-plus-size">Plus Size</label>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Expression (Research-Based)</h3>
                <p style="font-size: 0.85em; color: #7f8c8d; margin: -10px 0 15px 0; font-style: italic;">
                    Based on Ekman's universal emotions with cultural display rule variations
                </p>
                <div class="option-grid">
                    <div class="option-item">
                        <input type="radio" name="expression" id="exp-neutral" value="neutral-attentive" checked>
                        <label for="exp-neutral">Neutral Attentive</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="expression" id="exp-engaged" value="engaged-speaking">
                        <label for="exp-engaged">Engaged Speaking</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="expression" id="exp-thoughtful" value="thoughtful-processing">
                        <label for="exp-thoughtful">Thoughtful Processing</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="expression" id="exp-warm" value="warm-encouraging">
                        <label for="exp-warm">Warm Encouraging</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="expression" id="exp-polite" value="polite-questioning">
                        <label for="exp-polite">Polite Questioning</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="expression" id="exp-concerned" value="concerned-diplomatic">
                        <label for="exp-concerned">Concerned Diplomatic</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="expression" id="exp-surprised" value="surprised-interested">
                        <label for="exp-surprised">Surprised Interested</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="expression" id="exp-focused" value="focused-concentrating">
                        <label for="exp-focused">Focused Concentrating</label>
                    </div>
                </div>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px; font-size: 0.95em; color: #34495e;">Expression Intensity</h4>
                <p style="font-size: 0.85em; color: #7f8c8d; margin: -5px 0 15px 0; font-style: italic;">
                    Adjust for cultural display rules (e.g., subdued for East Asian contexts, expressive for Latin American)
                </p>
                <div class="option-grid">
                    <div class="option-item">
                        <input type="radio" name="intensity" id="int-subtle" value="subtle">
                        <label for="int-subtle">Subtle (Restrained)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="intensity" id="int-moderate" value="moderate" checked>
                        <label for="int-moderate">Moderate (Balanced)</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="intensity" id="int-expressive" value="expressive">
                        <label for="int-expressive">Expressive (Animated)</label>
                    </div>
                </div>
            </div>

            <div class="section">
                <h3>Facing Direction</h3>
                <div class="option-grid">
                    <div class="option-item">
                        <input type="radio" name="direction" id="dir-left" value="left" checked>
                        <label for="dir-left">Facing Left ‚Üê</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="direction" id="dir-right" value="right">
                        <label for="dir-right">Facing Right ‚Üí</label>
                    </div>
                    <div class="option-item">
                        <input type="radio" name="direction" id="dir-forward" value="forward">
                        <label for="dir-forward">Facing Forward ‚Üë</label>
                    </div>
                </div>
            </div>

            <h3 style="margin-top: 30px; margin-bottom: 15px;">Generated Prompt</h3>
            <div class="prompt-output" onclick="copyPrompt()" id="prompt">
                Select attributes above to generate your Midjourney prompt...
            </div>
            
            <div class="filename-section">
                <h4>Suggested Filename</h4>
                <div class="filename-output" onclick="copyFilename()" id="filename">
                    <span id="filename-text">Select attributes to generate filename...</span>
                    <span class="copy-icon">üìã</span>
                </div>
            </div>
            
            <button class="btn" id="save-character-btn" onclick="saveCharacter()">Save Character</button>
            <button class="btn btn-secondary" onclick="resetForm()">Reset Form</button>
            </div>

            <div class="saved-characters-panel">
                <h2 style="margin-bottom: 20px;">Saved Characters</h2>

                <div class="search-box">
                    <input type="text" id="search-input" placeholder="Search characters..." oninput="filterCharacters()">
                </div>

                <div id="characters-list"></div>

                <div class="export-import-section">
                    <h4 style="margin-bottom: 15px; color: #34495e;">Backup & Share</h4>
                    <button class="btn-small btn-export" onclick="exportCharacters()">Export All Characters</button>
                    <button class="btn-small btn-import" onclick="document.getElementById('import-file').click()">Import Characters</button>
                    <input type="file" id="import-file" accept=".json" style="display: none;" onchange="importCharacters(event)">
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast">Message</div>

    <script>
        // Attribute mappings
        const attributeMappings = {
            age: {
                'child': '10 year old',
                'teen': '16 year old',
                'young-adult': '28 year old',
                'middle-age': '45 year old',
                'senior': '65 year old'
            },
            gender: {
                'masculine': 'man',
                'feminine': 'woman',
                'non-binary': 'non-binary person with androgynous features'
            },
            ethnicity: {
                'east-asian': 'East Asian',
                'south-asian': 'South Asian',
                'middle-eastern': 'Middle Eastern',
                'african': 'Black/African',
                'latin-american': 'Latin American',
                'northern-european': 'Northern European',
                'southern-european': 'Mediterranean',
                'pacific-islander': 'Pacific Islander',
                'indigenous': 'Indigenous',
                'mixed': 'mixed ethnicity'
            },
            profession: {
                'business': 'business professional in formal attire',
                'healthcare': 'healthcare worker in medical scrubs',
                'teacher': 'teacher with casual professional attire',
                'tech': 'tech worker in casual modern clothing',
                'service': 'service worker in uniform',
                'student': 'student with backpack and casual clothes',
                'trades': 'construction worker in safety gear',
                'creative': 'artist in creative eclectic clothing',
                'scientist': 'scientist in lab coat',
                'farmer': 'agricultural worker in practical outdoor clothing'
            },
            expression: {
                'neutral-attentive': 'neutral professional expression with slight engagement, subtle mouth upturn, alert attentive eyes, eyebrows slightly raised showing interest',
                'engaged-speaking': 'actively speaking with moderate smile, mouth open showing teeth, animated expressive eyes, raised eyebrows, forward head position',
                'thoughtful-processing': 'contemplative expression with slight smile, eyes looking up and to the side, hand near chin in thinking gesture',
                'warm-encouraging': 'genuine duchenne smile with crow\'s feet, warm open eyes, relaxed eyebrows, slight head tilt showing empathy',
                'polite-questioning': 'curious expression with subtle smile, one eyebrow raised higher, head tilted 15 degrees, direct eye contact',
                'concerned-diplomatic': 'empathetic concern with compressed lips, furrowed brow showing care not anger, forward lean, soft eyes',
                'surprised-interested': 'positive surprise with open mouth smile, wide eyes, raised eyebrows, hands slightly raised in excitement',
                'focused-concentrating': 'determined expression with slight smile, narrowed eyes showing focus, lips pressed together, leaning forward'
            }
        };

        // Get readable labels
        const labels = {
            age: {
                'child': 'Child',
                'teen': 'Teen',
                'young-adult': 'YoungAdult',
                'middle-age': 'MiddleAge',
                'senior': 'Senior'
            },
            gender: {
                'masculine': 'Masculine',
                'feminine': 'Feminine',
                'non-binary': 'NonBinary'
            },
            ethnicity: {
                'east-asian': 'EastAsian',
                'south-asian': 'SouthAsian',
                'middle-eastern': 'MiddleEastern',
                'african': 'African',
                'latin-american': 'LatinAmerican',
                'northern-european': 'NorthernEuropean',
                'southern-european': 'SouthernEuropean',
                'pacific-islander': 'PacificIslander',
                'indigenous': 'Indigenous',
                'mixed': 'MixedHeritage'
            },
            profession: {
                'business': 'Business',
                'healthcare': 'Healthcare',
                'teacher': 'Teacher',
                'tech': 'Tech',
                'service': 'Service',
                'student': 'Student',
                'trades': 'Trades',
                'creative': 'Creative',
                'scientist': 'Scientist',
                'farmer': 'Agricultural'
            },
            expression: {
                'neutral-attentive': 'Neutral',
                'engaged-speaking': 'Speaking',
                'thoughtful-processing': 'Thoughtful',
                'warm-encouraging': 'Encouraging',
                'polite-questioning': 'Questioning',
                'concerned-diplomatic': 'Concerned',
                'surprised-interested': 'Surprised',
                'focused-concentrating': 'Focused'
            },
            direction: {
                'left': 'Left',
                'right': 'Right',
                'forward': 'Forward'
            }
        };

        function getSelectedAttributes() {
            const age = document.querySelector('input[name="age"]:checked')?.value || '';
            const gender = document.querySelector('input[name="gender"]:checked')?.value || '';
            const ethnicity = document.querySelector('input[name="ethnicity"]:checked')?.value || '';
            const profession = document.querySelector('input[name="profession"]:checked')?.value || '';
            const expression = document.querySelector('input[name="expression"]:checked')?.value || '';
            const intensity = document.querySelector('input[name="intensity"]:checked')?.value || 'moderate';
            const direction = document.querySelector('input[name="direction"]:checked')?.value || 'left';
            
            const diversityOptions = Array.from(document.querySelectorAll('input[type="checkbox"]:checked'))
                .map(cb => cb.value);

            return { age, gender, ethnicity, profession, expression, intensity, direction, diversityOptions };
        }

        function generatePrompt(attrs = null) {
            const attributes = attrs || getSelectedAttributes();
            
            if (!attributes.age || !attributes.gender || !attributes.ethnicity || !attributes.profession) {
                return 'Please select all required attributes';
            }

            let prompt = `SINGLE CHARACTER ONLY, flat design vector illustration, NOT cartoon, simple geometric shapes, minimal detail, clean lines, limited color palette, pure white background, full body standing pose, professional business illustration style NOT animated cartoon, `;
            
            
            // Add demographics
            prompt += `${attributeMappings.age[attributes.age]} ${attributeMappings.ethnicity[attributes.ethnicity]} ${attributeMappings.gender[attributes.gender]}, `;
            
            // Add profession
            prompt += `${attributeMappings.profession[attributes.profession]}, `;
            
            // Add diversity options
            if (attributes.diversityOptions && attributes.diversityOptions.length > 0) {
                const diversityDescriptions = {
                    'wheelchair': 'sitting in modern wheelchair',
                    'prosthetic': 'with visible prosthetic limb',
                    'glasses': 'wearing glasses',
                    'cane': 'using walking cane',
                    'hijab': 'wearing hijab',
                    'turban': 'wearing turban',
                    'plus-size': 'with plus-size body type'
                };
                
                // Filter out conflicting items
                let filteredOptions = attributes.diversityOptions;
                
                // If construction worker, remove turban (conflicts with hard hat)
                if (attributes.profession === 'trades') {
                    filteredOptions = filteredOptions.filter(opt => opt !== 'turban');
                }
                
                // If healthcare worker, remove hijab/turban (conflicts with medical cap requirements)
                if (attributes.profession === 'healthcare') {
                    filteredOptions = filteredOptions.filter(opt => opt !== 'turban' && opt !== 'hijab');
                }
                
                if (filteredOptions.length > 0) {
                    const diversityText = filteredOptions
                        .map(opt => diversityDescriptions[opt])
                        .join(', ');
                    prompt += `${diversityText}, `;
                }
            }
            
            // Add expression with intensity modifier
            const intensityModifiers = {
                'subtle': 'subtle restrained ',
                'moderate': '',
                'expressive': 'highly expressive energetic '
            };
            
            const expressionWithIntensity = intensityModifiers[attributes.intensity] + attributeMappings.expression[attributes.expression];
            
            // Add expression and direction with improved instructions
            if (attributes.direction === 'forward') {
                prompt += `character standing at slight angle facing mostly forward, shoulders square to viewer, ${expressionWithIntensity}, making direct eye contact with viewer/camera, engaging posture, `;
            } else {
                // Better three-quarter view instructions
                const directionDetails = {
                    'left': 'body at 30-45 degree angle facing left, NOT profile view, shoulders visible at angle, head turned slightly more left, gaze directed left toward invisible conversation partner',
                    'right': 'body at 30-45 degree angle facing right, NOT profile view, shoulders visible at angle, head turned slightly more right, gaze directed right toward invisible conversation partner'
                };
                prompt += `THREE-QUARTER ANGLE VIEW not side profile: ${directionDetails[attributes.direction]}, ${expressionWithIntensity}, engaged in conversation with someone off-frame, natural standing pose, `;
            }
            
            // Add isolation instructions
            prompt += `corporate flat design style, geometric simplified features, NOT photorealistic, NOT 3D rendered, isolated character on white background, no other people in image, `;
            prompt += `--seed 1580775571 --v 6 --style raw`;

            return prompt;
        }

        function generateFilename(attrs = null) {
            const attributes = attrs || getSelectedAttributes();
            
            if (!attributes.age || !attributes.gender || !attributes.ethnicity || !attributes.profession) {
                return 'Select attributes to generate filename...';
            }

            // Build filename parts
            let parts = [];
            
            // Add descriptive parts
            parts.push(labels.age[attributes.age]);
            parts.push(labels.gender[attributes.gender]);
            parts.push(labels.ethnicity[attributes.ethnicity]);
            parts.push(labels.profession[attributes.profession]);
            
            // Expression
            if (attributes.expression) {
                parts.push(labels.expression[attributes.expression]);
            }
            
            // Direction
            parts.push('Facing' + labels.direction[attributes.direction]);
            
            // Diversity options
            if (attributes.diversityOptions && attributes.diversityOptions.length > 0) {
                const diversityLabels = {
                    'wheelchair': 'Wheelchair',
                    'prosthetic': 'Prosthetic',
                    'glasses': 'Glasses',
                    'cane': 'Cane',
                    'hijab': 'Hijab',
                    'turban': 'Turban',
                    'plus-size': 'PlusSize'
                };
                
                attributes.diversityOptions.forEach(opt => {
                    if (diversityLabels[opt]) {
                        parts.push(diversityLabels[opt]);
                    }
                });
            }
            
            // Join with underscores
            return parts.join('_').replace(/\s+/g, '');
        }

        function updatePrompt() {
            const prompt = generatePrompt();
            document.getElementById('prompt').textContent = prompt;
            
            const filename = generateFilename();
            document.getElementById('filename-text').textContent = filename;
            
            // Show/hide diversity note based on profession
            const profession = document.querySelector('input[name="profession"]:checked')?.value;
            const diversityNote = document.getElementById('diversity-note');
            if (profession === 'trades' || profession === 'healthcare') {
                diversityNote.style.display = 'block';
            } else {
                diversityNote.style.display = 'none';
            }
        }

        function copyPrompt() {
            const prompt = document.getElementById('prompt').textContent;
            if (prompt !== 'Please select all required attributes' && prompt !== 'Select attributes above to generate your Midjourney prompt...') {
                navigator.clipboard.writeText(prompt).then(() => {
                    showToast('Prompt copied to clipboard!');
                }).catch(err => {
                    // Fallback for browsers that don't support clipboard API
                    const textArea = document.createElement("textarea");
                    textArea.value = prompt;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showToast('Prompt copied to clipboard!');
                });
            }
        }

        function copyFilename() {
            const filename = document.getElementById('filename-text').textContent;
            if (filename !== 'Select attributes to generate filename...') {
                navigator.clipboard.writeText(filename).then(() => {
                    showToast('Filename copied to clipboard!');
                }).catch(err => {
                    // Fallback for browsers that don't support clipboard API
                    const textArea = document.createElement("textarea");
                    textArea.value = filename;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    showToast('Filename copied to clipboard!');
                });
            }
        }

        function resetForm() {
            // Reset to defaults
            document.querySelector('input[name="age"][value="young-adult"]').checked = true;
            document.querySelector('input[name="gender"][value="feminine"]').checked = true;
            document.querySelector('input[name="ethnicity"][value="south-asian"]').checked = true;
            document.querySelector('input[name="profession"][value="business"]').checked = true;
            document.querySelector('input[name="expression"][value="neutral-attentive"]').checked = true;
            document.querySelector('input[name="intensity"][value="moderate"]').checked = true;
            document.querySelector('input[name="direction"][value="left"]').checked = true;
            
            // Clear checkboxes
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            
            updatePrompt();
            showToast('Form reset to defaults');
        }

        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show';
            if (type === 'error') toast.classList.add('error');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }

        // LocalStorage Functions
        const STORAGE_KEY = 'cross-cultural-characters';

        function loadCharactersFromStorage() {
            const stored = localStorage.getItem(STORAGE_KEY);
            return stored ? JSON.parse(stored) : [];
        }

        function saveCharactersToStorage(characters) {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(characters));
        }

        function saveCharacter() {
            const name = document.getElementById('character-name').value.trim();

            if (!name) {
                showToast('Please enter a character name', 'error');
                return;
            }

            const attributes = getSelectedAttributes();

            if (!attributes.age || !attributes.gender || !attributes.ethnicity || !attributes.profession) {
                showToast('Please select all required attributes', 'error');
                return;
            }

            const character = {
                id: Date.now(),
                name: name,
                attributes: attributes,
                prompt: generatePrompt(attributes),
                filename: generateFilename(attributes),
                createdAt: new Date().toISOString()
            };

            const characters = loadCharactersFromStorage();
            characters.unshift(character); // Add to beginning
            saveCharactersToStorage(characters);

            renderCharactersList();
            showToast(`Character "${name}" saved!`);

            // Clear name field
            document.getElementById('character-name').value = '';
        }

        function deleteCharacter(id) {
            if (!confirm('Are you sure you want to delete this character?')) {
                return;
            }

            let characters = loadCharactersFromStorage();
            characters = characters.filter(c => c.id !== id);
            saveCharactersToStorage(characters);

            renderCharactersList();
            showToast('Character deleted');
        }

        function loadCharacter(id) {
            const characters = loadCharactersFromStorage();
            const character = characters.find(c => c.id === id);

            if (!character) {
                showToast('Character not found', 'error');
                return;
            }

            // Set name
            document.getElementById('character-name').value = character.name;

            // Set attributes
            const attrs = character.attributes;

            if (attrs.age) document.querySelector(`input[name="age"][value="${attrs.age}"]`).checked = true;
            if (attrs.gender) document.querySelector(`input[name="gender"][value="${attrs.gender}"]`).checked = true;
            if (attrs.ethnicity) document.querySelector(`input[name="ethnicity"][value="${attrs.ethnicity}"]`).checked = true;
            if (attrs.profession) document.querySelector(`input[name="profession"][value="${attrs.profession}"]`).checked = true;
            if (attrs.expression) document.querySelector(`input[name="expression"][value="${attrs.expression}"]`).checked = true;
            if (attrs.intensity) document.querySelector(`input[name="intensity"][value="${attrs.intensity}"]`).checked = true;
            if (attrs.direction) document.querySelector(`input[name="direction"][value="${attrs.direction}"]`).checked = true;

            // Clear all checkboxes first
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);

            // Set diversity options
            if (attrs.diversityOptions && attrs.diversityOptions.length > 0) {
                attrs.diversityOptions.forEach(opt => {
                    const checkbox = document.querySelector(`input[type="checkbox"][value="${opt}"]`);
                    if (checkbox) checkbox.checked = true;
                });
            }

            updatePrompt();
            showToast(`Loaded character "${character.name}"`);

            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function renderCharactersList(filter = '') {
            const characters = loadCharactersFromStorage();
            const listEl = document.getElementById('characters-list');

            if (characters.length === 0) {
                listEl.innerHTML = `
                    <div class="empty-state">
                        <p>No saved characters yet.<br>Create and save your first character!</p>
                    </div>
                `;
                return;
            }

            // Filter characters
            const filtered = filter
                ? characters.filter(c => {
                    const searchText = filter.toLowerCase();
                    return c.name.toLowerCase().includes(searchText) ||
                           c.filename.toLowerCase().includes(searchText) ||
                           Object.values(c.attributes).some(v =>
                               String(v).toLowerCase().includes(searchText)
                           );
                  })
                : characters;

            if (filtered.length === 0) {
                listEl.innerHTML = `
                    <div class="empty-state">
                        <p>No characters found matching "${filter}"</p>
                    </div>
                `;
                return;
            }

            listEl.innerHTML = filtered.map(char => `
                <div class="character-card">
                    <h4>${escapeHtml(char.name)}</h4>
                    <div class="character-meta">
                        ${labels.age[char.attributes.age]} ‚Ä¢
                        ${labels.gender[char.attributes.gender]} ‚Ä¢
                        ${labels.ethnicity[char.attributes.ethnicity]}
                    </div>
                    <div class="character-meta">
                        ${labels.profession[char.attributes.profession]} ‚Ä¢
                        ${labels.expression[char.attributes.expression]}
                    </div>
                    <div class="character-actions">
                        <button class="btn-small btn-load" onclick="loadCharacter(${char.id})">Load</button>
                        <button class="btn-small btn-delete" onclick="deleteCharacter(${char.id})">Delete</button>
                    </div>
                </div>
            `).join('');
        }

        function filterCharacters() {
            const searchTerm = document.getElementById('search-input').value.trim();
            renderCharactersList(searchTerm);
        }

        function exportCharacters() {
            const characters = loadCharactersFromStorage();

            if (characters.length === 0) {
                showToast('No characters to export', 'error');
                return;
            }

            const dataStr = JSON.stringify(characters, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `characters_export_${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            showToast(`Exported ${characters.length} character(s)`);
        }

        function importCharacters(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);

                    if (!Array.isArray(imported)) {
                        showToast('Invalid file format', 'error');
                        return;
                    }

                    const existing = loadCharactersFromStorage();

                    // Merge, avoiding duplicates by ID
                    const existingIds = new Set(existing.map(c => c.id));
                    const newCharacters = imported.filter(c => !existingIds.has(c.id));

                    const merged = [...existing, ...newCharacters];
                    saveCharactersToStorage(merged);

                    renderCharactersList();
                    showToast(`Imported ${newCharacters.length} new character(s)`);

                } catch (err) {
                    showToast('Error reading file', 'error');
                    console.error(err);
                }
            };
            reader.readAsText(file);

            // Reset file input
            event.target.value = '';
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Add event listeners
        document.querySelectorAll('input[type="radio"], input[type="checkbox"]').forEach(input => {
            input.addEventListener('change', updatePrompt);
        });

        // Initialize
        updatePrompt();
        renderCharactersList();
    </script>
</body>
</html>